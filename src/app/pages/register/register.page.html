<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/login"></ion-back-button>
    </ion-buttons>
    <ion-title>Register</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="register-container">
    <ion-card>
      <ion-card-header class="ion-text-center">
        <ion-icon name="person-add-outline" size="large" color="primary"></ion-icon>
        <ion-card-title>Create an Account</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <form [formGroup]="registerForm" (ngSubmit)="register()">
          <div class="profile-image-container ion-padding-bottom">
            <ion-label class="profile-image-label">Profile Picture (Optional)</ion-label>
            <div class="profile-image-preview" [class.has-image]="profileImage">
              @if (profileImage) {
                <img [src]="profileImage" alt="Profile Preview">
              } @else {
                <div class="profile-image-placeholder">
                  <ion-icon name="person-circle-outline"></ion-icon>
                </div>
              }
            </div>

            <div class="upload-buttons">
              <input #fileUpload type="file" (change)="onFileSelected($event)" accept="image/*" hidden>
              <ion-button (click)="fileUpload.click()" fill="outline" class="upload-button">
                <ion-icon name="image-outline" slot="start"></ion-icon>
                Upload Image
              </ion-button>
              @if (profileImage) {
                <ion-button (click)="removeImage()" fill="clear" color="danger" size="small">
                  <ion-icon name="trash-outline" slot="start"></ion-icon> Remove
                </ion-button>
              }
            </div>
          </div>
          <ion-list>
            <ion-item>
              <ion-input label="First Name" labelPlacement="stacked" formControlName="firstName" type="text" required></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Last Name" labelPlacement="stacked" formControlName="lastName" type="text" required></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Email" labelPlacement="stacked" formControlName="email" type="email" required></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Address" labelPlacement="stacked" formControlName="address" type="text" required></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Contact Number" labelPlacement="stacked" formControlName="contactNumber" type="tel" required></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Password" labelPlacement="stacked" formControlName="password" type="password" required></ion-input>
            </ion-item>
            <ion-item>
              <ion-input label="Confirm Password" labelPlacement="stacked" formControlName="confirmPassword" type="password" required></ion-input>
            </ion-item>
          </ion-list>

          @if (registerForm.errors?.['passwordsMismatch'] && registerForm.get('confirmPassword')?.dirty) {
            <ion-note class="ion-padding-start" color="danger">
              Passwords do not match.
            </ion-note>
          }
          @if (registerForm.get('password')?.dirty && registerForm.get('password')?.errors) {
            <ion-note class="ion-padding-start">
              <div [class.valid]="!registerForm.get('password')?.errors?.['minLength']"><ion-icon [name]="!registerForm.get('password')?.errors?.['minLength'] ? 'checkmark-circle' : 'close-circle'" [color]="!registerForm.get('password')?.errors?.['minLength'] ? 'success' : 'danger'"></ion-icon> At least 8 characters</div>
              <div [class.valid]="!registerForm.get('password')?.errors?.['uppercase']"><ion-icon [name]="!registerForm.get('password')?.errors?.['uppercase'] ? 'checkmark-circle' : 'close-circle'" [color]="!registerForm.get('password')?.errors?.['uppercase'] ? 'success' : 'danger'"></ion-icon> An uppercase letter</div>
              <div [class.valid]="!registerForm.get('password')?.errors?.['lowercase']"><ion-icon [name]="!registerForm.get('password')?.errors?.['lowercase'] ? 'checkmark-circle' : 'close-circle'" [color]="!registerForm.get('password')?.errors?.['lowercase'] ? 'success' : 'danger'"></ion-icon> A lowercase letter</div>
              <div [class.valid]="!registerForm.get('password')?.errors?.['number']"><ion-icon [name]="!registerForm.get('password')?.errors?.['number'] ? 'checkmark-circle' : 'close-circle'" [color]="!registerForm.get('password')?.errors?.['number'] ? 'success' : 'danger'"></ion-icon> A number</div>
              <div [class.valid]="!registerForm.get('password')?.errors?.['special']"><ion-icon [name]="!registerForm.get('password')?.errors?.['special'] ? 'checkmark-circle' : 'close-circle'" [color]="!registerForm.get('password')?.errors?.['special'] ? 'success' : 'danger'"></ion-icon> A special character (!@#...)</div>
            </ion-note>
          }

          <ion-button class="register-button" type="submit" expand="block" [disabled]="registerForm.invalid">
            Register
          </ion-button>
        </form>

        <div class="login-link">
          <ion-text>
            Already have an account? <a routerLink="/login">Log in</a>
          </ion-text>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>